import 'game/style.css'; // webpack magic
//import {FBInstant} from 'mock/fbinstant.6.0.mock.js'
import { Point, SCALE_MODES, settings, Sprite, Rectangle } from 'pixi.js';
settings.SCALE_MODE = SCALE_MODES.LINEAR;

import * as engine from 'engine';
import * as display from 'engine/display';
import * as resources from 'engine/resources';
import Scene from 'engine/Scene';
import { Soldier } from 'game/Soldier';

class TestScene extends Scene {
  init() {
    this.backgroundColor = 0xEEEEEE;

    const ele = document.getElementById("Root");
    ele.style.width = display.width;
    ele.style.height = display.height;

    this.bound = new Rectangle(0, 0, display.width, display.height);
    const center = new Point(0, display.height / 2);


    this.character = new Soldier(this.createSprite("soldier", this.stage), center);


    //this.character.position.
  }

  createSprite(id, container) {
    const sprite = Sprite.fromFrame(id);
    sprite.anchor.set(0.5, 0.5);
    container.addChild(sprite);
    return sprite;
  }

  update(dt) {
    this.character.update(dt);
  }
}

const USE_FB_INSTANT = false;
const scene = new TestScene;

window.addEventListener('touchstart', function () {
  // the user touched the screen!
});

window.startGame = function () {
  const parentElement = document.getElementById("Root");
  engine.launch(scene, { parentElement });
}

window.postScore = function (score) {
  window.FBInstant.getLeaderboardAsync('Happy Worm.' + window.FBInstant.context.getID())
    .then(leaderboard => {
      return leaderboard.setScoreAsync(score);
    })
    .then(() => {
      window.FBInstant.updateAsync({
        action: 'LEADERBOARD',
        name: 'Happy Worm.' + window.FBInstant.context.getID()
      });
    });
}

window.onload = function () {
  if (USE_FB_INSTANT) {
    window.FBInstant.initializeAsync()
      .then(function () {
        // Start loading game assets here
        window.FBInstant.startGameAsync()
          .then(function () {
            window.startGame();
          });
      });
  } else {
    window.startGame();
  }
};