import 'game/style.css'; // webpack magic
import * as engine from 'engine';
import * as display from 'engine/display';
import { StartScene } from 'game/StartScene';


const USE_FB_INSTANT = false;
let scene = new TestScene;

window.addEventListener('touchstart', function() {
  // the user touched the screen!
  engine.scene.onTouch();
});

window.startGame = function() {
  const parentElement = document.getElementById("Root");

  engine.launch(new StartScene, { parentElement })
    .then(() => {
      parentElement.style.width = display.width;
      parentElement.style.height = display.height;
    });
};

window.postScore = function(score) {
  if (USE_FB_INSTANT) {
    let leaderboardIns = null;
    window.FBInstant.getLeaderboardAsync('Happy Worm.' + window.FBInstant.context.getID())
      .then((leaderboard) => {
        leaderboardIns = leaderboard;
        leaderboard.getPlayerEntryAsync();
      })
      .then((entry) => {
        const bestscore = entry.getScore();
        if (score > bestscore)
          leaderboardIns.setScoreAsync(score)
            .then(() => {
              window.FBInstant.updateAsync({
                action: 'LEADERBOARD',
                name: 'Happy Worm.' + window.FBInstant.context.getID(),
              });
            });
      });
  }
};

window.onload = function() {
  if (USE_FB_INSTANT) {
    window.FBInstant.initializeAsync()
      .then(function() {
        // Start loading game assets here
        window.FBInstant.startGameAsync()
          .then(function() {
            window.startGame();
          });
      });
  } else {
    window.startGame();
  }
};